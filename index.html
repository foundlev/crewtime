<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Flight Time Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="time-block">
                <div class="time-label">МОСКВА</div>
                <div class="time-value" id="moscow-time">--:--</div>
                <div class="date-value" id="moscow-date">-- --- ----</div>
            </div>

            <div class="time-difference" id="time-difference">+0ч</div>

            <div class="time-block" style="align-items: flex-end;">
                <div class="time-label">МЕСТНОЕ</div>
                <div class="time-value" id="local-time">--:--</div>
                <div class="date-value" id="local-date">-- --- ----</div>
            </div>
        </header>

        <div class="flight-card" id="flight-card">
            <div class="flight-header">
                <div>
                    <div class="flight-main-info">
                        <div class="flight-number">SU ----</div>
                        <div class="pilot-badge pilot-badge--work" title="Рабочий рейс">
                            <i class="fas fa-plane"></i>
                            <span class="pilot-badge-text">Рабочий</span>
                        </div>
                        <div class="location-badge location-badge--home" title="Из дома">
                            <i class="fas fa-home"></i>
                            <span class="location-badge-text">Из дома</span>
                        </div>
                    </div>
                    <div class="flight-time">--:--</div>
                    <div class="flight-details">
                        <div class="flight-date">-- ----. ----</div>
                        <div class="flight-duration">- ч -- мин</div>
                    </div>
                </div>
                <div class="flight-actions">
                    <button class="action-button" id="refresh-flight" title="Обновить">
                        <i class="fas fa-sync-alt" style="font-size: 0.9rem;"></i>
                    </button>
                </div>
            </div>

            <div class="flight-route">
                <div class="airport">
                    <div class="airport-code">--- / ----</div>
                    <div class="airport-name">------</div>
                </div>
                <div class="route-arrow">
                    <i class="fas fa-long-arrow-alt-right"></i>
                </div>
                <div class="airport">
                    <div class="airport-code">--- / ----</div>
                    <div class="airport-name">------</div>
                </div>
            </div>

            <div class="flight-meta" id="flight-meta">
                <div class="flight-meta-badges">
                    <div class="meta-badge meta-badge--source" id="data-source-badge" title="Источник данных">
                        <i class="fas fa-database"></i>
                        <span id="data-source-text">Аккорд</span>
                    </div>

                    <div class="meta-badge meta-badge--empty" id="web-time-badge" title="Сверка времени с Web">
                        <i class="fas fa-circle-question"></i>
                        <span id="web-time-text">WEB: нет данных</span>
                    </div>

                    <div class="meta-badge meta-badge--empty" id="updated-badge" title="Когда обновляли данные">
                        <i class="fas fa-clock"></i>
                        <span id="updated-text">--</span>
                    </div>
                </div>

            </div>
        </div>

        <div class="countdown-card">
            <div class="countdown-icon">
                <i class="fa-regular fa-hourglass" id="next-stage-icon"></i>
            </div>
            <div class="countdown-content">
                <div class="countdown-label" id="next-stage-label">Загружаем информацию</div>
                <div class="countdown-time" id="next-stage-time">- ч -- мин</div>
            </div>
        </div>

        <div class="stages-container">
            <div class="stage-item" data-stage="rest">
                <div class="stage-icon">
                    <i class="fas fa-moon"></i>
                </div>
                <div class="stage-time">22:00</div>
                <div class="stage-label">Отдых</div>
                <div class="stage-countdown">за 0:30</div>
            </div>
            <div class="stage-item" data-stage="sleep">
                <div class="stage-icon">
                    <i class="fas fa-bed"></i>
                </div>
                <div class="stage-time">22:30</div>
                <div class="stage-label">Отбой</div>
                <div class="stage-countdown">за 8:00</div>
            </div>
            <div class="stage-item" data-stage="wakeup">
                <div class="stage-icon">
                    <i class="fas fa-bell"></i>
                </div>
                <div class="stage-time">06:40</div>
                <div class="stage-label">Подъём</div>
                <div class="stage-countdown">за 1:10</div>
            </div>
            <div class="stage-item" data-stage="taxi">
                <div class="stage-icon">
                    <i class="fas fa-taxi"></i>
                </div>
                <div class="stage-time">07:50</div>
                <div class="stage-label">Такси</div>
                <div class="stage-countdown">за 0:10</div>
            </div>
            <div class="stage-item" data-stage="exit">
                <div class="stage-icon">
                    <i class="fas fa-door-open"></i>
                </div>
                <div class="stage-time">08:00</div>
                <div class="stage-label">Выход</div>
                <div class="stage-countdown">за 2:30</div>
            </div>
        </div>

        <div class="sleep-settings-card">
            <div class="sleep-header">
                <div class="sleep-title">Время сна</div>
                <div class="sleep-toggle-container">
                    <span class="toggle-label">Сон</span>
                    <label class="toggle-switch">
                        <input type="checkbox" class="toggle-checkbox" id="sleep-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <button class="settings-button-small" id="settings-button-small" title="Настройки">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
            <div class="sleep-controls">
                <button class="sleep-button" id="sleep-decrease" disabled>
                    <i class="fas fa-minus"></i>
                </button>
                <div class="sleep-value" id="sleep-value">9:00</div>
                <button class="sleep-button" id="sleep-increase">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Модальное окно настроек -->
    <div class="modal" id="settings-modal">
        <div class="modal-backdrop" id="settings-modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Настройки</div>
                <button class="modal-close" id="settings-modal-close">&times;</button>
            </div>

            <div class="modal-section">
                <div class="modal-section-title">Из дома</div>
                <div class="time-settings-grid">
                    <div class="time-setting">
                        <div class="time-label">Отдых</div>
                        <input type="time" class="time-input" value="00:30" step="60" data-setting="home_rest">
                    </div>
                    <div class="time-setting">
                        <div class="time-label">Подъём</div>
                        <input type="time" class="time-input" value="01:10" step="60" data-setting="home_wakeup">
                    </div>
                    <div class="time-setting">
                        <div class="time-label">Такси</div>
                        <input type="time" class="time-input" value="00:10" step="60" data-setting="home_taxi">
                    </div>
                    <div class="time-setting">
                        <div class="time-label">Выход</div>
                        <input type="time" class="time-input" value="02:30" step="60" data-setting="home_exit">
                    </div>
                </div>
            </div>

            <div class="modal-section">
                <div class="modal-section-title">Из отеля</div>
                <div class="time-settings-grid">
                    <div class="time-setting">
                        <div class="time-label">Отдых</div>
                        <input type="time" class="time-input" value="00:30" step="60" data-setting="hotel_rest">
                    </div>
                    <div class="time-setting">
                        <div class="time-label">Подъём</div>
                        <input type="time" class="time-input" value="01:10" step="60" data-setting="hotel_wakeup">
                    </div>
                    <div class="time-setting">
                        <div class="time-label">Выход</div>
                        <input type="time" class="time-input" value="00:10" step="60" data-setting="hotel_taxi">
                    </div>
                    <div class="time-setting">
                        <div class="time-label">Выезд</div>
                        <input type="time" class="time-input" value="02:30" step="60" data-setting="hotel_exit">
                    </div>
                </div>
            </div>

            <div class="auth-section">
                <div class="modal-section-title">Авторизация</div>
                <input type="text" class="auth-input" placeholder="Логин" value="demo_user" id="login-input">
                <div class="password-container">
                    <input type="password" class="auth-input" placeholder="Пароль" value="password" id="password-input">
                    <button class="password-toggle" id="password-toggle">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <div class="modal-actions">
                <button class="modal-button modal-button-secondary" id="cancel-settings">Отмена</button>
                <button class="modal-button modal-button-primary" id="save-settings">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно редактирования этапа -->
    <div class="modal" id="stage-modal">
        <div class="modal-backdrop" id="stage-modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modal-stage-title">Редактирование этапа</div>
                <button class="modal-close" id="stage-modal-close">&times;</button>
            </div>
            <div class="modal-time-controls">
                <button class="modal-time-button" id="time-decrease" title="Минус 5 минут">
                    <i class="fas fa-minus"></i>
                </button>

                <input type="time" class="time-input modal-time-picker" id="modal-time-input" step="60" />

                <button class="modal-time-button" id="time-increase" title="Плюс 5 минут">
                    <i class="fas fa-plus"></i>
                </button>
            </div>

            <div class="modal-subinfo">
                <div class="modal-subinfo-label">Рассчитанное:</div>
                <div class="modal-subinfo-value" id="modal-calculated-time">--:--</div>
            </div>

            <div class="modal-info">
                <div class="modal-info-item">
                    <span id="modal-next-stage-label">До следующего этапа:</span>
                    <span id="modal-next-stage">- ч -- мин</span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-button modal-button-secondary" id="reset-time">Сбросить</button>
                <button class="modal-button modal-button-primary" id="save-time">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно информации о рейсе -->
    <div class="modal" id="flight-modal">
        <div class="modal-backdrop" id="flight-modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Информация о рейсе</div>
                <button class="modal-close" id="flight-modal-close">&times;</button>
            </div>
            <div style="margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                    <div id="modal-flight-number" style="font-size: 24px; font-weight: 700; color: var(--primary-color);">SU 1004</div>
                    <div id="modal-flight-duration" style="font-size: 14px; font-weight: 600; color: var(--primary-color); background: rgba(0, 122, 255, 0.1); padding: 4px 10px; border-radius: 8px; margin-top: 4px;">-- ч -- мин</div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                    <div style="flex: 1;">
                        <div id="modal-dep-codes" style="font-size: 18px; font-weight: 600;">SVO / UUEE</div>
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <div id="modal-dep-city" style="font-size: 14px; opacity: 0.7;">Шереметьево</div>
                            <div style="display: flex;">
                                <div id="modal-dep-tz" class="tz-offset-pill" style="display: none;">МСК+1</div>
                            </div>
                        </div>
                    </div>
                    <div style="text-align: center; padding: 0 10px; margin-top: 2px;">
                        <i class="fas fa-long-arrow-alt-right" style="color: var(--primary-color); font-size: 18px;"></i>
                    </div>
                    <div style="text-align: right; flex: 1;">
                        <div id="modal-arr-codes" style="font-size: 18px; font-weight: 600;">KGD / UMKK</div>
                        <div style="display: flex; flex-direction: column; gap: 4px; align-items: flex-end;">
                            <div id="modal-arr-city" style="font-size: 14px; opacity: 0.7;">Калининград</div>
                            <div style="display: flex;">
                                <div id="modal-arr-tz" class="tz-offset-pill" style="display: none;">МСК-1</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-info">
                <div class="modal-info-item">
                    <span>Источник данных:</span>
                    <div class="source-toggle" id="source-toggle">
                        <button class="source-button active" data-source="accord">
                            <i class="fas fa-database"></i> Аккорд
                        </button>
                        <button class="source-button" data-source="calendar">
                            <i class="fas fa-calendar-alt"></i> Календарь
                        </button>
                        <button class="source-button" data-source="manual">
                            <i class="fas fa-edit"></i> Ручной
                        </button>
                    </div>
                </div>

                <!-- Блок ручного ввода -->
                <div id="manual-input-section" style="display: none; margin-top: 16px; padding: 16px; background: rgba(142, 142, 147, 0.1); border-radius: 14px; border: 1px solid var(--border-color); overflow: hidden; transition: all 0.3s ease;">
                    <div id="manual-input-container">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                            <div style="grid-column: span 2;">
                                <div class="time-label" style="margin-bottom: 6px;">Номер рейса</div>
                                <input type="text" id="manual-flight-number" class="auth-input" style="margin-bottom: 0; padding: 10px;" placeholder="SU 1004">
                            </div>
                            <div>
                                <div class="time-label" style="margin-bottom: 6px;">Вылет (ICAO/IATA)</div>
                                <input type="text" id="manual-dep-icao" class="auth-input" style="margin-bottom: 0; padding: 10px; text-transform: uppercase;" placeholder="UUEE" maxlength="4">
                            </div>
                            <div>
                                <div class="time-label" style="margin-bottom: 6px;">Прилет (ICAO/IATA)</div>
                                <input type="text" id="manual-arr-icao" class="auth-input" style="margin-bottom: 0; padding: 10px; text-transform: uppercase;" placeholder="UMKK" maxlength="4">
                            </div>
                            <div>
                                <div class="time-label" style="margin-bottom: 6px;">Дата вылета</div>
                                <input type="date" id="manual-departure-date" class="auth-input" style="margin-bottom: 0; padding: 10px;">
                            </div>
                            <div>
                                <div class="time-label" style="margin-bottom: 6px;">Время (местное)</div>
                                <input type="time" id="manual-departure-time" class="auth-input" style="margin-bottom: 0; padding: 10px;">
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-actions" style="margin-top: 0;">
                        <button class="modal-button modal-button-primary" id="manual-save-btn">Сохранить</button>
                        <button class="modal-button modal-button-secondary" id="manual-edit-btn" style="display: none;">Изменить</button>
                        <button class="modal-button modal-button-error" id="manual-delete-btn" style="display: none; background: var(--status-error); color: white;">Удалить</button>
                    </div>
                </div>

                <div id="modal-sources-list" style="margin-top: 16px; display: flex; flex-direction: column; gap: 10px;">
                    <!-- Сюда будут динамически рендериться источники -->
                </div>
            </div>
        </div>
    </div>
    <script src="assets/data/airports_tz.js"></script>
    <script src="assets/data/iata_icao.js"></script>
    <script src="assets/data/icao_info.js"></script>
    <script src="script.js"></script>
</body>
</html>
